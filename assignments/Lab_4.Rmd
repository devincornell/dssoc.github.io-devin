---
title: "Lab #4: Basics of Programming"
author: "Data Science and Society (Sociology 367)"
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this lab, we will practice the fundamentals of programming. Edit the Lab #4 markdown file ([link to file](https://github.com/dssoc/dssoc.github.io/raw/master/assignments/Lab_4.Rmd)) for your submission. Remember to change the "author" field above to your name. Send the markdown file (.Rmd) to your TA via direct message on Slack. Be sure to do the required reading!

**Required reading:** [R for Data Science: Basic Programming (17 -21)](https://r4ds.had.co.nz/program-intro.html).

**Optional reading:** [More on functions](https://rstudio.cloud/learn/primers/6).


### Required Datasets

The tables that you will be drawing on for this lab can be downloaded from the course website: 

(1) `nominees`: [grammy_nominees_20102020.Rdata](https://github.com/dssoc/dssoc.github.io/raw/master/datasets/grammy_nominees_20102020.Rdata) is a table of Grammy nominees from 2010 to 2020 in the categories "Album of the year" (album_oty), "Record of the year" (record_oty), "Song of the year (song_oty), and "Best new artist of the year" (new_artist_oty).
(2) `winners`: [grammy_winners_20102020.Rdata](https://github.com/dssoc/dssoc.github.io/raw/master/datasets/grammy_winners_20102020.Rdata) is a table of Grammy winners for the above listed categories, from 2010 to 2020.


The exercises in this lab correspond with R for Data Science, [chapters 17 - 21](https://r4ds.had.co.nz/program-intro.html):


Load the libraries and datasets:
```{r}
library(tidyverse)
load('../datasets/grammy_nominees_20102020.Rdata')
load('../datasets/grammy_winners_20102020.Rdata')
```
<br/><br/>

### Exercises
<br/>

**1. In your own words, describe what Boolean operators are, and provide one example of how you might use them in a data science project.**
```{r}
# your answer here
```
<br/>

**2. In your own words, describe what a function is, and provide one example of how you might use it in a data science project.**
```{r}
# your answer here
```
<br/>

**3. Most of the time, packages in R contain many useful functions/commands. If you didn't know what a certain function did, or how it worked, where within R Studio would you look to learn more / see example code?**
```{r}
# your answer here
```
<br/>

**4. Write a function that takes a character vector as data and returns the first letter in each element. To show that it works, test it on the character vector below.**
```{r}
sentence <- c('you', 'only', 'understand', 'data', 'if', 'data', 'is', 'tidy')
# your answer here
firsts <- function(sent) {
  return(map(sent, function(w){substr(w,1,1)}))
}

#sentence
t <- firsts(sentence)
print(t)

```
<br/>

**5. In your reading, you learned about function arguments. Using the `winners` table, write a function that takes year (numeric) as an argument and returns the name of all winners for that year. It's alright if the function simply returns the row for that year in the `winners` table, but you can also print each winner name if you'd like.**
```{r}
# your answer here
winners_get <- function(yr) {
  cols <- c('record_oty', 'album_oty', 'song_oty', 'new_artist_oty')
  winnercols <- c('1', '2', '3')
  all_winners <- winners %>% 
    filter(year==yr) %>% 
    pivot_longer(cols, names_to='award', values_to='winners') %>% 
    separate(winners, ',', into=winnercols) %>% 
    pivot_longer(winnercols, names_to='order', values_to='name') %>% 
    mutate(order=as.numeric(order)) %>% 
    drop_na(name)
  return(all_winners)
}
print(winners_get(2020))
```
<br/>

**6. Sometimes we would like to execute different commands or calculations depending on the structure of our data. You learned about this in the *conditional execution* section of your reading. Expand your function from Exercise 5 to return "Date not available" if a year is supplied to the function but is not in the dataset.**
```{r}
# your answer here
winners_get_conditional <- function(yr) {
  if (yr %in% winners$year) {
    cols <- c('record_oty', 'album_oty', 'song_oty', 'new_artist_oty')
    winnercols <- c('1', '2', '3')
    all_winners <- winners %>% 
      filter(year==yr) %>% 
      pivot_longer(cols, names_to='award', values_to='winners') %>% 
      separate(winners, ',', into=winnercols) %>% 
      pivot_longer(winnercols, names_to='order', values_to='name') %>% 
      mutate(order=as.numeric(order)) %>% 
      drop_na(name)
    return(all_winners)
  }
  else {
    return ('Date not available')
  }
}
print(winners_get_conditional(2000)) # should return string
print(winners_get_conditional(2020)) # returns correct dataframe
```
<br/>


**7. Now, using the `nominees` table, write code to calculate the percent of nominations that have only one performer. For this, you might want to consider using the `is.na()` function that you learned about in your reading.**
```{r}
# your answer here
noms_solo <- nominees %>% 
  mutate(is_solo=is.na(performer2) & is.na(performer3)) %>% 
  mutate(is_solo=as.numeric(is_solo))
mean(noms_solo$is_solo)
```
<br/>

**8. As in one of the previous labs, below I define two vectors corresponding to policies that US States have adopted to respond to COVID-19: restrictions on travel ([recorded May 20, 2020](https://www.wsj.com/articles/a-state-by-state-guide-to-coronavirus-lockdowns-11584749351)) and requirements that citizens to wear masks in public ([recorded August 17, 2020](https://www.cnn.com/2020/06/19/us/states-face-mask-coronavirus-trnd/index.html)). Run this code to create the vectors yourself.**
```{r}
travel_restrictions <- c("WA", "OR", "NV", "CA", "NM", "MN", "IL", "OH", "MI", "PA", "VA", "NY", "MA", "VH", "ME", "DE", "MD", "NJ")

require_masks <- c("HI", "WA", "OR", "NV", "CA", "MT", "CO", "NM", "KS", "TX", "MN", "AR", "LA", "WI", "IL", "AL", "MI", "IN", "OH", "KY", "WV", "NC", "VA", "DC", "DE", "PA", "NY", "VT", "NH", "MA", "RI", "CT", "ME")
```

**Iterate over the states which issued travel restrictions, and print "[state abbreviation] issued travel restrictions but didn't require masks" if they did not require masks.**
```{r}
# your answer here
for (st in travel_restrictions) {
  if (st %in% require_masks) {
    print(cat(st, 'issued travel restrictions but didn\'t require masks'))
  }
}
```
<br/>

**9. Change one element or step in your answer to Exercise 8 to provide an alternative way of completing the exercise. For instance, if you did not use a for loop in your first attempt, perhaps use one now. If you did use a for loop in your first attempt, perhaps consider using `paste()` and `setdiff()` instead.**
```{r}
```
<br/>

**10. Perform a transformation of your choice on one of the datasets provided for this Lab. Annotate your code to describe what your transformation does to someone who might later read your code (e.g. the TA ;) As a reminder, you should be at least modestly annotating all of your Lab answers.**
```{r}
# your answer here
winners %>% 
  filter(year>2015) %>% # keepign only winners after 2015
  select(record_oty, year) %>% # only keep two columns
  separate(record_oty, ',', into=c('1','2','3')) %>%  # separate out artist order
  pivot_longer(c('1','2','3'), names_to='order', values_to='artist') %>% # convert artist order to rows
  drop_na(artist) # remove blank rows
  
```

